<?xml version="1.0" encoding="UTF-8"?>
<!--
	File created by Christian Schneider <chrschn@sec.in.tum.de>
-->
<typeknowledge version="1">
    <rules>
		<rule priority="90">
			<!--
				References:
				http://lxr.linux.no/#linux+v2.6.32.58/include/linux/percpu-defs.h#L8
				http://lxr.linux.no/#linux+v2.6.32.58/include/asm-generic/percpu.h#L18
				http://lxr.linux.no/#linux+v2.6.32.58/include/asm-generic/percpu.h#L54
			-->
			<name>per_cpu__*</name>
			<description>Returns the first entry of a per-cpu variable for x86.</description>
			<filter>
				<variablename match="wildcard">per_cpu__*</variablename>
			</filter>
			<action type="inline">
				var inst = arguments[0];
				var offsets = new Instance("__per_cpu_offset");
				// Is this an SMP system?
				if (offsets.IsValid()) {
					var offset = offsets.ArrayElem(0);
					inst.AddToAddress(offset.toULong(16));
				}
				return inst;
			</action>
		</rule>
	</rules>
</typeknowledge>
